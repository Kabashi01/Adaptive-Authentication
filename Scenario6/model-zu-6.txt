;;Fuzzy Goals
(declare-fun AdapAuthR () Real)
(declare-fun Security () Real)
(declare-fun Usability () Real)
(declare-fun Performance() Real)

;;AdapAuthR = Security && Usability && Performance 
(assert (and (<= AdapAuthR 
             (ite (<= Security Usability) 
                  (ite (<= Security Performance) Security  Performance) 
                  (ite (<= Usability Performance) Usability Performance)))))


(declare-fun AvgPerformance() Real)
(declare-fun AVGPerforSum() Real)
(declare-fun  PerforSum () Real)

(assert (and (<= 0 AdapAuthR ) (<= AdapAuthR 1)))
(assert (and (<= 0 Security ) (<= Security 1)))
(assert (and (<= 0 Usability) (<= Usability 1))) 
(assert (and (<= 0 Performance) (<= Performance 1)))
(assert (and (<= 0 AvgPerformance) (<= AvgPerformance 1)))
(assert (and (<= 0 AVGPerforSum  ) (<= AVGPerforSum   1)))

;;Fuzzy Security Goals
(declare-fun  Authenticity() Real)
(declare-fun  Confidentiality () Real)
(declare-fun  Integrity () Real)

;;Security = Authenticity && Confidentiality && Integrity 
(assert (and (<= Security 
             (ite (<= Authenticity Confidentiality) 
                  (ite (<= Authenticity Integrity) Authenticity  Integrity) 
                  (ite (<= Confidentiality Integrity) Confidentiality Integrity)))))

(declare-fun  AvgAuthenticity() Real)
(declare-fun  AvgConfidentiality () Real)
(declare-fun  AvgIntegrity () Real)
(declare-fun  AuthentPriority () Real)
(declare-fun  ConfPriority  () Real)
(declare-fun  IntegPriority () Real)
(declare-fun  PerformancePriority () Real)

(declare-fun  SumInteg () Real)
(declare-fun  AVGSumInteg () Real)
(declare-fun  SumConf () Real)
(declare-fun  AVGSumConf () Real)
(declare-fun  SumAuth () Real)
(declare-fun  AVGSumAuth () Real)



;;Fuzzy Security Goals
(assert (and (<= 0 Authenticity) (<= Authenticity 1)))
(assert (and (<= 0 Confidentiality) (<= Confidentiality 1)))
(assert (and (<= 0 Integrity) (<= Integrity 1)))

(assert (and (<= 0 AvgAuthenticity) (<= AvgAuthenticity 1)))
(assert (and (<= 0 AvgConfidentiality) (<= AvgConfidentiality 1)))
(assert (and (<= 0 AvgIntegrity) (<= AvgIntegrity 1)))

(assert (and (<= 0 AuthentPriority) (<= AuthentPriority 1)))
(assert (and (<= 0 ConfPriority) (<= ConfPriority 1)))
(assert (and (<= 0 IntegPriority) (<= IntegPriority 1)))
(assert (and (<= 0 PerformancePriority) (<= PerformancePriority 1)))

(assert (and (<= 0 AVGSumInteg) (<= AVGSumInteg 1)))



(assert (and (<= 0 AVGSumAuth ) (<= AVGSumAuth  1)))


(assert (and (<= 0 AVGSumConf ) (<= AVGSumConf 1)))



;;Fuzzy usability Goals
(declare-fun  Effectiveness  () Real)
(declare-fun  Efficiency () Real)

(declare-fun  AvgEfficiency () Real)
(declare-fun  AvgEffectiveness  () Real)

(declare-fun  EffectPriority  () Real)
(declare-fun  EfficPriority () Real)
(declare-fun  EfficSum () Real)
(declare-fun  AVGEfficSum () Real)
(declare-fun  EffetSum () Real)
(declare-fun  AVGEffetSum () Real)

;;Fuzzy usability Goals
(assert (and (<= 0 Effectiveness) (<= Effectiveness 1)))
(assert (and (<= 0 Efficiency) (<= Efficiency 1)))

(assert (and (<= 0 AvgEffectiveness) (<= AvgEffectiveness 1)))
(assert (and (<= 0 AvgEfficiency) (<= AvgEfficiency 1)))

(assert (and (<= 0 EffectPriority) (<= EffectPriority 1)))
(assert (and (<= 0 EfficPriority) (<= EfficPriority 1)))


(assert (and (<= 0 AVGEfficSum  ) (<= AVGEfficSum  1)))

(assert (and (<= 0 AVGEffetSum  ) (<= AVGEffetSum  1)))

;;Utility
(declare-fun Utility () Real)
(assert (and (<= 0 Utility) (<= Utility 1)))
(declare-fun count() Real)  
	     
                            
;;Usability = Effectiveness && Efficiency
(assert (and (<= Usability (ite (<= Effectiveness  Efficiency)  Effectiveness   Efficiency))))


;; Fuzzy contextual factor (Value,Presence) 
(declare-fun Location() Real)
(declare-fun UnsecuredWiFi() Real)
(declare-fun InsecNetwork() Real)
(declare-fun UnusualTime() Real)
(declare-fun UnknownDevice() Real)
(declare-fun PoorLighting () Real)

(declare-fun Controlled() Real)
(declare-fun TreatmentPlan() Real)
(declare-fun NonControlled() Real)

;; 0 positive and 1 negative
(assert (or (=  Location 0) (= Location 1)))
(assert (or (=  UnsecuredWiFi 0) (= UnsecuredWiFi 1)))
(assert (or (=  InsecNetwork 0) (= InsecNetwork 1)))
(assert (or (=  UnusualTime 0) (= UnusualTime 1)))
(assert (or (=  UnknownDevice 0) (= UnknownDevice 1)))
(assert (or (=  PoorLighting 0) (= PoorLighting 1)))

;; Controlled & Non-Controlled Prescription
(assert (or (=  Controlled 0) (= Controlled 1)))
(assert (or (=  NonControlled 0) (= NonControlled 1)))



;;---------------------

(declare-fun CredType () Real)
(declare-fun SomeKnow() Real)
(declare-fun SomeHave () Real)
(declare-fun Signature () Real)
(declare-fun SomeAre() Real)
(declare-fun TwoFactor() Real)
(declare-fun PassStr() Real)
(declare-fun PinLeng() Real)
(declare-fun OtpLeng() Real)

(declare-fun Certificate () Real)
(declare-fun PlateLicense() Real)
(declare-fun SmartCard () Real)
(declare-fun Token () Real)
(declare-fun Face () Real)
(declare-fun Iris() Real)
(declare-fun Fingerprint() Real) 
(declare-fun SignCryp () Real)
(declare-fun GroupSign() Real)
(declare-fun RingSign () Real)

;; setup the count variable
(assert (ite (> TwoFactor 0) (= count 2) (= count 1)))

;; CRISP Authentication Methods
(assert (or (=  Certificate 0) (= Certificate 1)))
(assert (or (=  PlateLicense 0) (= PlateLicense 1)))
(assert (or (=  SmartCard 0) (= SmartCard 1)))
(assert (or (=  Token 0) (= Token 1)))
(assert (or (=  Face 0) (= Face 1)))
(assert (or (=  Iris 0) (= Iris 1)))
(assert (or (=  Fingerprint 0) (= Fingerprint 1)))
(assert (or (=  SignCryp 0) (= SignCryp 1)))
(assert (or (=  GroupSign 0) (= GroupSign 1)))
(assert (or (=  RingSign 0) (= RingSign 1)))
(declare-fun CredRnew () Real)
(declare-fun CredRnewFactor () Real)

;; FUZZY Authentication Methods
(assert (and (< 0 CredType) (<= CredType 1)))
(assert (and (<= 0 SomeKnow) (<=  SomeKnow 1)))
(assert (and (<= 0 SomeHave) (<= SomeHave 1)))
(assert (and (<= 0 Signature) (<= Signature 1)))
(assert (and (<= 0 SomeAre) (<= SomeAre 1)))
(assert (and (<= 0 TwoFactor) (<= TwoFactor 1)))

;; PassStr= short(0.5) || medium (0.7) ||  Long(1.0)
(assert (or (=  PassStr 0.0) (=  PassStr 0.5) (= PassStr 0.7) (= PassStr 1.0)))

;; PinLeng= short(0.5) || medium (0.7) ||  Long(1.0)
(assert (or (=  PinLeng 0.0) (=  PinLeng 0.5) (= PinLeng 0.7) (= PinLeng 1.0)))
;; OtpLeng= short(0.5) || medium (0.7) ||  Long(1.0)
(assert (or (=  OtpLeng 0.0) (=  OtpLeng 0.5) (= OtpLeng 0.7) (= OtpLeng 1.0)))
 
;;;;;;;;;;;;;;;;;;;;Authentication methods;;;;;;;;;;;;;;;;;;;;

;;;;;;;;;;Assign value to CredType;;;;;;;;;;
(assert (= CredType (ite (> TwoFactor 0) TwoFactor
                          (ite (>= SomeKnow SomeHave)
                               (ite (>= SomeKnow  SomeAre) SomeKnow SomeAre) 
                               (ite (>= SomeHave SomeAre) SomeHave SomeAre)) 
)))


;;TwoFactor =  Select two from (SomeKnow, SomeHave, SomeAre)
(assert (ite (and (> SomeKnow 0) (> SomeHave 0))
             (and (> TwoFactor 0) (= SomeAre 0)) true))

(assert (ite (and (> SomeAre 0) (> SomeHave 0))
             (and (> TwoFactor 0) (= SomeKnow 0)) true))

(assert (ite (and (> SomeAre 0) (> SomeKnow 0))
             (and (> TwoFactor 0) (= SomeHave 0)) true))

(assert (ite (> TwoFactor 0) (or (and (> SomeAre 0) (> SomeHave 0) (= SomeKnow 0)) (and (> SomeHave 0) (> SomeKnow 0) (= SomeAre 0)) (and (> SomeKnow 0) (> SomeAre 0) (= SomeHave 0))) true))

;;TwoFactor value = Max(1, MAX(SomeKnow,SomeHave,SomeAre) + 0.2)
(assert (ite (and (> SomeKnow 0) (> SomeHave 0)) 
              (= TwoFactor (ite (> SomeKnow SomeHave) (ite (< SomeKnow 0.8) (+ SomeKnow 0.2) 1) (ite (< SomeHave 0.8) (+ SomeHave 0.2) 1)) ) true))

(assert (ite (and (> SomeAre 0) (> SomeHave 0)) 
              (= TwoFactor (ite (> SomeAre SomeHave) (ite (< SomeAre 0.8) (+ SomeAre 0.2) 1) (ite (< SomeHave 0.8) (+ SomeHave 0.2) 1)) ) true))


(assert (ite (and (> SomeAre 0) (> SomeKnow 0)) 
              (= TwoFactor (ite (> SomeAre SomeKnow) (ite (< SomeAre 0.8) (+ SomeAre 0.2) 1) (ite (< SomeKnow 0.8) (+ SomeKnow 0.2) 1)) ) true))


;;if TwoFactor = 0 then Choose one between (SomeKnow, SomeHave, SomeAre)
(assert (ite (and (= TwoFactor 0) (> SomeKnow 0)) (and (= SomeAre 0) (= SomeHave 0)) true))
(assert (ite (and (= TwoFactor 0) (> SomeHave 0)) (and (= SomeAre 0) (= SomeKnow 0)) true))
(assert (ite (and (= TwoFactor 0) (> SomeAre 0)) (and (= SomeKnow 0) (= SomeHave 0)) true))

;;SomeKnow = MAX (PinLeng,PassStr,OtpLeng)
(assert (= SomeKnow (ite (>= PinLeng PassStr)
                    (ite (>= PinLeng OtpLeng) PinLeng OtpLeng )
                    (ite (>= PassStr OtpLeng) PassStr OtpLeng ))))

;; Choose only one from (PinLeng,PassStr,OtpLeng)
(assert (ite (> PinLeng 0) (and (= PassStr 0) (= OtpLeng 0)) true))
(assert (ite (> PassStr 0) (and (= PinLeng 0) (= OtpLeng 0)) true))
(assert (ite (> OtpLeng 0) (and (= PassStr 0) (= PinLeng 0)) true))

;;SomeHave = MAX (PlateLicense,Certificate, SmartCard, Signature)  
(assert (= SomeHave (ite (>= PlateLicense Certificate) 
                         (ite (>= PlateLicense SmartCard)
                              (ite (>= PlateLicense Signature) PlateLicense Signature) 
                              (ite (>= SmartCard Signature) SmartCard Signature)) 
	            (ite (>= Certificate SmartCard) 
		         (ite (>= Certificate Signature) Certificate Signature) 
	                 (ite (>= SmartCard  Signature) SmartCard Signature)))))    


;; Choose only one from (PlateLicense,Certificate, SmartCard, Signature)
(assert (ite (> PlateLicense 0) (and (= Certificate 0) (= SmartCard 0) (= Signature 0)) true))

(assert (ite (> Certificate 0) (and (= PlateLicense 0) (= SmartCard 0) (= Signature 0)) true))

(assert (ite (> SmartCard 0) (and (= PlateLicense 0) (= Certificate 0) (= Signature 0)) true))

(assert (ite (> Signature 0) (and (= PlateLicense 0) (= Certificate 0) (= SmartCard 0)) true))


;;Signature = MAX (Token,SignCryp, GroupSign, RingSign)
(assert (= Signature (ite (>= Token SignCryp )
                          (ite (>= Token  GroupSign)
                               (ite (>= Token  RingSign ) Token  RingSign) 
                               (ite (>= GroupSign   RingSign ) GroupSign RingSign)) 
		    (ite (>= SignCryp GroupSign) 
	                 (ite (>= SignCryp  RingSign) SignCryp  RingSign) 
	                 (ite (>= GroupSign RingSign) GroupSign RingSign))
)))


;; Choose only one between (Token, SignCryp, GroupSign, RingSign)
(assert (ite (> Token 0) (and (= SignCryp 0) (= GroupSign 0) (= RingSign 0)) true))

(assert (ite (> SignCryp 0) (and (= Token 0) (= GroupSign 0) (= RingSign 0)) true))

(assert (ite (> GroupSign 0) (and (= Token 0) (= SignCryp 0) (= RingSign 0)) true))

(assert (ite (> RingSign 0) (and (= Token 0) (= SignCryp 0) (= GroupSign 0)) true))


;;SomeAre = MAX (Face,Iris,Fingerprint)
(assert (= SomeAre (ite (>= Face Iris)
                        (ite (>= Face Fingerprint) Face Fingerprint)
                        (ite (>= Iris Fingerprint) Iris Fingerprint ))))

;;;;Choose only one between (Face,Iris,Fingerprint)               
(assert (ite (> Face 0) (and (= Iris 0) (= Fingerprint 0)) true))
(assert (ite (> Iris 0) (and (= Face 0) (= Fingerprint 0)) true))
(assert (ite (> Fingerprint 0) (and (= Face 0) (= Iris 0)) true))

;;Automation level
(declare-fun AutoLevel () Real)

;; AutoLevel = Not-Automated (0)|| semi-Automated (0.5) || FullAutomated(1.0)
;; PIN&Password&OTP are not automated 
(assert (ite (or (> PinLeng 0) (> PassStr 0) (> OtpLeng 0)) (= AutoLevel 0) 
        (ite (or (> Token 0) (> SmartCard 0) (> Fingerprint 0)(> Face 0)(> Iris 0) (> SignCryp 0) (> GroupSign 0)
           (> RingSign 0)) (= AutoLevel 0.5) 
              (= AutoLevel 1) )))

;;;; CredRnew => (Face&Iris&Fingerprint are not Renewal(0) || Daily(0.90) || Weekly(0.50) || Monthly(0.30) || Yearly(0.10) )

(assert (ite (> SomeKnow 0)  
                  (or (= CredRnew  0.90) (= CredRnew 0.50) (= CredRnew 0.30) (= CredRnew 0.10))    
                  (= CredRnew  0)))


;; DevType
;;(declare-fun DevType () Real)
(declare-fun PC () Real)
(declare-fun LapTop () Real)
(declare-fun Phone () Real)
(declare-fun Reader () Real)
(declare-fun Camera () Real)
(declare-fun Scanner () Real)

(assert (or (=  PC 0) (= PC 1)))
(assert (or (=  LapTop 0) (= LapTop 1)))
(assert (or (=  Reader 0) (= Reader 1)))
(assert (or (=  Phone 0) (= Phone 1)))
(assert (or (=  Camera 0) (= Camera 1)))
(assert (or (=  Scanner 0) (= Scanner 1)))

;; DevType (PC,LapTop,Phone,Reader, Camera, Scanner)               
(assert (ite (or (> PinLeng 0) (> PassStr 0) (> OtpLeng 0) (> Certificate 0) (> Token 0) (> SignCryp 0) (> GroupSign 0) (> RingSign 0))  (or (> PC 0) (> LapTop 0) (> Phone 0)) true))  

(assert (ite (or  (> Face 0) (> Iris 0) (> PlateLicense 0)) (> Camera 0) true ))
(assert (ite  (>  Fingerprint 0)   (> Scanner 0) true ))
(assert (ite  (>  SmartCard  0)    (> Reader 0)  true )) 



;;;;;;;;;;;;;;;;;;Impact on the requirements;;;;;;;;;;;;;;;;;;

;; SUM (authentication methods  impact on the Confidentiality psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                                                                                                                           
(assert (= SumConf (+ (* PinLeng  0.5) 
                      (* PassStr 0.5)
                      (* OtpLeng 0.5) 
                      (* PlateLicense 0.4)
                      (* Certificate 0.8)
                      (* SmartCard 0.6)
                      (* Token 0.8)
                      (* SignCryp 0.8)
                      (* GroupSign 0.8)
                      (* RingSign 0.8)
                      (* Iris 0.8)
                      (* Face 0.8)
                      (* Fingerprint 0.8) (ite (> TwoFactor 0) 0.4 0)  )))

;; Proper average + clamp
(assert (= AVGSumConf (/ SumConf count)))



;; Credential Renewal Discount Factor
(assert (= CredRnewFactor  (/ (- 1 CredRnew) 2))) 

;; the impact of  CredRnew on the Confidentiality 
(assert (ite (> SomeKnow 0)
             (ite (>= AVGSumConf CredRnew)
                  (= AvgConfidentiality (ite (> 0 (- AVGSumConf CredRnewFactor)) 0 (- AVGSumConf CredRnewFactor)))
                  (= AvgConfidentiality (ite (> 1 (+ AVGSumConf CredRnewFactor)) (+ AVGSumConf CredRnewFactor) 1))) true))  

(assert (ite (= SomeKnow 0) (= AvgConfidentiality AVGSumConf) true))

;;; SUM (authentication methods  impact on the Authenticity positive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                                                           
(assert (= SumAuth (+ (* PinLeng 0.1) 
                      (* PassStr 0.1)  
                      (* OtpLeng 0.1) 
                      (* PlateLicense 0.5)
                      (* Certificate 0.8 )
                      (* SmartCard 0.5 )
                      (* Token  0.5)
                      (* SignCryp 0.8)
                      (* GroupSign 0.8)
                      (* RingSign 0.8)
                      (* Iris  0.5)
                      (* Face 0.5)
                      (* Fingerprint 0.5) (ite (> TwoFactor 0) 0.4 0) )))

(assert (= AVGSumAuth (/ SumAuth count)))




(assert (= AvgAuthenticity AVGSumAuth))
                                                                   
;; SUM(authentication methods  impact on the Integrity psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)              
         
(assert (= SumInteg (+ (* PinLeng  0.5) 
                       (* PassStr 0.5)
                       (* OtpLeng 0.5) 
                       (* PlateLicense 0.4)
                       (* Certificate 0.8)
                       (* SmartCard 0.6)
                       (* Token 0.8)
                       (* SignCryp 0.8)
                       (* GroupSign 0.8)
                       (* RingSign 0.8)
                       (* Iris 0.8)
                       (* Face 0.8)
                       (* Fingerprint 0.8) (ite (> TwoFactor 0) 0.4 0 )
                        )))

(assert (= AVGSumInteg (/ SumInteg count)))

                      
 ;; the impact of  CredRnew on the Integrity  
;; the impact of  CredRnew on the Confidentiality 
(assert (ite (> SomeKnow 0)
             (ite (>= AVGSumInteg CredRnew)
                  (= AvgIntegrity (ite (> 0 (- AVGSumInteg CredRnewFactor)) 0 (- AVGSumInteg CredRnewFactor)))
                  (= AvgIntegrity (ite (> 1 (+ AVGSumInteg CredRnewFactor)) (+ AVGSumInteg CredRnewFactor) 1))) true))         

(assert (ite (= SomeKnow 0)
             (= AvgIntegrity AVGSumInteg)
             true))                          

;;SUM (authentication methods  impact on the Efficiency psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                          

(declare-fun EfficSumBase () Real)

(assert (= EfficSumBase
    (+ (* PinLeng 0.3)
       (* PassStr 0.3)
       (* OtpLeng 0.3) 
       (* PlateLicense 0.8)
       (* Certificate 0.1)
       (* SmartCard 0.6)
       (* Token 0.5)
       (* SignCryp 0.1)
       (* GroupSign 0.1)
       (* RingSign 0.1)
       (* Iris 0.5)
       (* Face 0.5)
       (* Fingerprint 0.5)
    )))

;; Penalty on usability when TwoFactor is used
;; Here we subtract 0.1 from the efficiency score if TwoFactor > 0

(assert
  (ite (> TwoFactor 0)
       (= EfficSum
          (ite (> (- EfficSumBase 0.1) 0)
               (- EfficSumBase 0.1)
               0))           
       (= EfficSum EfficSumBase)))
                                  
 ;; Avg Efficiency                                   
 (assert (= AVGEfficSum (/ EfficSum  count) ))
 
;; AvgEfficiency =MAX (AVGEfficSum , AutoLevel)                                         
 (assert  (ite (> AVGEfficSum AutoLevel) 
               (= AvgEfficiency AVGEfficSum)                                                
               (= AvgEfficiency AutoLevel)))


;; SUM (authentication methods  impact on the Effectiveness psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                          

(declare-fun EffetSumBase () Real)
(assert (= EffetSumBase  (+ (* PinLeng 0.1)
                                 (* PassStr 0.1)
                                 (* OtpLeng 0.1) 
                                 (* PlateLicense 0.8)
                                 (* Certificate 0.4)
                                 (* SmartCard 0.6)
                                 (* Token 0.5)
                                 (* SignCryp 0.8)
                                 (* GroupSign 0.8)
                                 (* RingSign 0.8)
                                 (* Iris 0.5)
                                 (* Face 0.5)
                                 (* Fingerprint 0.5) )
                                  )) 

;; Penalty on usability when TwoFactor is used
;; Here we subtract from the Effectiveness score if TwoFactor > 0

(assert
  (ite (> TwoFactor 0)
       (= EffetSum
          (ite (> (- EffetSumBase 0.1) 0)
               (- EffetSumBase 0.1)
               0))           
       (= EffetSum EffetSumBase)))

;; Avg Effectiveness                                   
(assert (= AVGEffetSum  (/ EffetSum  count) ))

;;AvgEffectiveness =MAX(AVGEffetSum ,(- 1 CredRnew), AutoLevel )
(assert  (ite (>= AVGEffetSum (-  1 CredRnew))
              (ite (>= AVGEffetSum  AutoLevel) 
                   (= AvgEffectiveness AVGEffetSum) 
                   (= AvgEffectiveness AutoLevel))
              (ite (>= (-  1 CredRnew)  AutoLevel) 
                   (= AvgEffectiveness (-  1 CredRnew)) 
                   (= AvgEffectiveness AutoLevel))
))

;; SUM (authentication methods impact on the Performance psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                          

(declare-fun PerforSumBase () Real)

(assert (= PerforSumBase  (+ (* PinLeng 0.8)
                               (* PassStr 0.8)
                               (* OtpLeng 0.8) 
                               (* PlateLicense 0.8)
                               (* Certificate 0.1)
                               (* SmartCard 0.6)
                               (* Token 0.5)
                               (* SignCryp 0.1)
                               (* GroupSign 0.1)
                               (* RingSign 0.1)
                               (* Iris 0.3)
                               (* Face 0.3)
                               (* Fingerprint 0.5) )
                                  ))        

;; Penalty on performance when TwoFactor is used
(assert
  (ite (> TwoFactor 0)
       (= PerforSum
          (ite (> (- PerforSumBase 0.1) 0)
               (- PerforSumBase 0.1)
               0))
       (= PerforSum PerforSumBase)))  


 ;; Avg Performance 
(assert (= AVGPerforSum  (/ PerforSum  count) ))
(assert (= AvgPerformance AVGPerforSum)    )     
 
;;  AutoLevel
;; (assert  (ite (>= AVGPerforSum  AutoLevel) 
;;               (= AvgPerformance AVGPerforSum)   
;;               (= AvgPerformance AutoLevel))) 


;;;;; Impact of contextual factors on asset value ;;;;;

(declare-fun AssetValue() Real)
(assert (and (> AssetValue 0) (<= AssetValue 1)))

;; If(> Controlled 0)  Controlled prescribtion asset value (very high 0.8)
(assert (ite (and (> Controlled 0) (= TreatmentPlan 1) (= NonControlled 1))
               (= AssetValue 0.725) true  ))

;; If (> TreatmentPlan 0) TreatmentPlan asset value (Medium 0.5) 
(assert (ite (and (> TreatmentPlan 0) (= Controlled 0) (= NonControlled 1))
               (= AssetValue 0.6) true  ))

;; If (> NonControlled 0) NonControlled asset value (Medium 0.5) 
(assert (ite (and (> NonControlled 0) (= Controlled 0) (= TreatmentPlan 0))
               (= AssetValue 0.5) true  ))

;; If the controlled prescribtion is on then the doctor can also prescribe the Non-Controlled 
(assert (ite (> Controlled 0) (and (= NonControlled 1) (= TreatmentPlan 1)) true))

;; If the treatment plan is on then the doctor can also prescribe the Non-Controlled 
(assert (ite (> TreatmentPlan 0) (= NonControlled 1) true))






;;---------------------------------
;;;; The contextual factors impact on the requirements priority
;; Usability Priority high(0.8 -1.0) medium (0.5) low (0)
;; Security Priority high(0.8) medium (0.5) low (0)  
;; Performance Priority high(0.8) medium (0.5) low (0)

;; The impact of the unfamiliar location on the requirements
(assert (ite (> Location 0)  
     (and 
        (> ConfPriority 0.75)         ;; Location can increase confidentiality priority
        (> AuthentPriority  0.8)      ;; Unusual location may suggest impersonation attempt — raises authenticity priority
        (> IntegPriority 0.74)        ;; Data might be modified 
        (> EffectPriority 0.64)        ;; Slight usability concern 
        (> EfficPriority 0.6)         ;; 
        (> PerformancePriority 0.55))  ;; Slight impact 
      true )) 

;; The impact of unusual time on the requirements
(assert (ite (> UnusualTime 0)
     (and 
        (> ConfPriority 0.6)         ;; Late hours can expose data if attacker exploits time gaps — confidentiality raised
        (> AuthentPriority  0.7)     ;; Abnormal access time suggests possible impersonation — authenticity rises
        (> IntegPriority 0.5)        ;; Risk of unintended changes at odd hours
        (> EffectPriority 0.5)        ;; Slight 
        (> EfficPriority 0.5)        ;; 
        (< PerformancePriority 0.65))  ;; 
      true ))

;; The impact of unknown device on the requirements
(assert (ite (> UnknownDevice 0)
  (and
    (> ConfPriority 0.7)            ;; Personal or unmanaged devices are prone to data leakage — confidentiality is critical
    (> AuthentPriority 0.75)          ;; Device unfamiliarity raises impersonation risk
    (< IntegPriority 0.75)           ;; Integrity of submitted/modified data may be questioned
    (< EffectPriority 0.65)           ;; Potential usability impact 
    (< EfficPriority 0.65)            ;; Effort increased for verification on new device
    (> PerformancePriority 0.64))      ;; May slow access due to additional checks 
  true))

;; The impact of unsecured WiFi on the authentication requirements
(assert (ite (> UnsecuredWiFi 0)
     (and 
          (< ConfPriority 0.85)       ;; MITM attacks more likely — confidentiality at high risk
          (< AuthentPriority 0.82)    ;; Session hijacking or spoofing possible — higher authenticity needed
          (> IntegPriority 0.65)      ;; Data integrity during transmission may be compromised
          (> EffectPriority 0.5)      ;; Slight usability impact from fallback to safer methods
          (> EfficPriority 0.55)      ;; 
          (> PerformancePriority 0.5) ;; 
     ) 
  true))


;;  If (> NightTime 0) ( (= Iris 0)& (= Face  0) )                   
(assert (ite (> PoorLighting 0)  (and (= Iris 0) (= Face  0) ) true ))   


;;--------------------------------

;;The value of each requirement is equal to the Avg value multiplied the priority
;; Confidentiality= (AvgConfidentiality * ConfPriority)
(assert (= Confidentiality (* AvgConfidentiality ConfPriority)))

;; Integrity = (AvgIntegrity * IntegPriority)          
(assert (= Integrity (* AvgIntegrity IntegPriority))) 

;; Authenticity= (AvgAuthenticity * AuthentPriority) 
(assert (= Authenticity (* AvgAuthenticity AuthentPriority))) 

;; Efficiency= (AvgEfficiency * EfficPriority)
(assert (= Efficiency (* AvgEfficiency EfficPriority)))

;; Effectiveness= (AvgEffectiveness * EffectPriority)
(assert (= Effectiveness (* AvgEffectiveness EffectPriority)))

;; Performance= (AvgPerformance * PerformancePriority)
(assert (= Performance (* AvgPerformance PerformancePriority))) 


;;;;Attacks
;; I have added the Risk before the mitigation as BPRisk
(declare-fun PImpersAttack() Real)
(declare-fun FPImpersAttack() Real)
(declare-fun PRiskPImpersAttack() Real )
(declare-fun BPRiskPImpersAttack() Real )

(assert (and (<= 0 PImpersAttack ) (<= PImpersAttack 1)))
(assert (and (<= 0 FPImpersAttack ) (<= FPImpersAttack 1)))
(assert (and (<= 0 PRiskPImpersAttack ) (<= PRiskPImpersAttack 1)))
(assert (and (<= 0 BPRiskPImpersAttack ) (<= BPRiskPImpersAttack 1)))

(declare-fun PReplayAttack() Real)
(declare-fun FPReplayAttack() Real)
(declare-fun PRiskReplayAttack() Real)
(declare-fun BPRiskReplayAttack() Real)

(assert (and (<= 0 PReplayAttack ) (<= PReplayAttack 1)))
(assert (and (<= 0 FPReplayAttack ) (<= FPReplayAttack 1)))
(assert (and (<= 0 PRiskReplayAttack ) (<= PRiskReplayAttack 1)))
(assert (and (<= 0 BPRiskReplayAttack ) (<= BPRiskReplayAttack 1)))


;;Session Hijacking attack
(declare-fun PSessionAttack() Real)
(declare-fun FPSessionAttack() Real)
(declare-fun PRiskSessionAttack() Real)
(declare-fun BPRiskSessionAttack() Real)

(assert (and (<= 0 PSessionAttack ) (<= PSessionAttack 1)))
(assert (and (<= 0 FPSessionAttack ) (<= FPSessionAttack 1)))
(assert (and (<= 0 PRiskSessionAttack ) (<= PRiskSessionAttack 1)))

;;---------- The Context Impact On Attacks Likelihood
;; high(0.8) medium (0.5) low (0)

;; Unsecured WiFi can be easily intercepted by attackers. Replay attacks are likely due to token reuse, 
;; and session hijacking is highly likely due to lack of encryption or protection.

(assert (ite (> UnsecuredWiFi 0)
  (and
    (< PReplayAttack 0.7)       ;; Replay risk high: attacker may intercept and reuse tokens
    (< PSessionAttack 0.75))     ;; Session hijacking very likely over open networks
  true))

;; Unknown Device may be compromised or lack trusted configurations.
;; High impersonation risk due to possible malware 
(assert (ite (> UnknownDevice 0)
  (and
    (= PImpersAttack 0.7)      ;; Impersonation risk high: compromised or spoofed identity
    (> PReplayAttack 0.6))      ;; Replay risk moderate: stored tokens may be reused
  true))

;; Unfamiliar Location implies deviation from normal patterns, suggesting a potential attacker.
;; Moderate to high impersonation and session hijacking risk due to context anomaly.
(assert (ite (> Location 0)
  (and
    (>= PImpersAttack 0.7)       ;; Impersonation risk moderate-high: user location is suspicious
    (>= PSessionAttack 0.7))     ;; Session hijacking risk elevated: access from unknown place
  true))









;; -----------Consider this section after the authentication-------------
(declare-fun  ImpersAttackImpact () Real) 
(declare-fun  ReplayAttackImpact () Real) 
(declare-fun  SessionAttackImpact () Real) 

(assert (and (<= 0 ImpersAttackImpact ) (<= ImpersAttackImpact 1)))
(assert (and (<= 0 ReplayAttackImpact ) (<= ReplayAttackImpact 1)))
(assert (and (<= 0 SessionAttackImpact ) (<= SessionAttackImpact 1)))


;; Total Risk before any Mitigation
(declare-fun  TotalRisk () Real)


(assert (and (<= 0 TotalRisk ) (<= TotalRisk 1)))



 ;; AVG (authentication methods impact on the PImpersAttack psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                          
(assert (<= ImpersAttackImpact (/ (+ (* PinLeng 0.3)
                               (* PassStr 0.3)
                               (* OtpLeng 0.3) 
                               (* PlateLicense 0.1)
                               (* Certificate 0.7)
                               (* SmartCard 0.3)
                               (* Token 0.3)
                               (* SignCryp 0.1)
                               (* GroupSign 0.1)
                               (* RingSign 0.1)
                               (* Iris 0.1)
                               (* Face 0.1)
                               (* Fingerprint 0.1) (ite (> TwoFactor 0) 0.3 0)) count )
                                  ))  



;;PPImpersAttack=(PkPImpersAttack - ImpersAttackImpact)
(assert (=  FPImpersAttack (- PImpersAttack ImpersAttackImpact )))

;; AVG (authentication methods impact on the PImpersAttack psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                          
(assert (<= ReplayAttackImpact (/ (+ (* PinLeng 0.3)
                               (* PassStr 0.3)
                               (* OtpLeng 0.1) 
                               (* PlateLicense 0.1)
                               (* Certificate 0.7)
                               (* SmartCard 0.3)
                               (* Token 0.1)
                               (* SignCryp 0.1)
                               (* GroupSign 0.1)
                               (* RingSign 0.1)
                               (* Iris 0.1)
                               (* Face 0.1)
                               (* Fingerprint 0.1) (ite (> TwoFactor 0) 0.3 0)) count )
                                  ))  


;;Final PReplayAttack  =(PReplayAttack - ReplayAttackImpact )
(assert (= FPReplayAttack (- PReplayAttack ReplayAttackImpact )))


;; AVG (authentication methods impact on the PImpersAttack psitive (0.5) very positively (0.8) , negative (0.3), very negative(0.1) and not impact (0)                          
(assert (<= SessionAttackImpact (/ (+ (* PinLeng 0.2)
                               (* PassStr 0.2)
                               (* OtpLeng 0.3) 
                               (* PlateLicense 0.1)
                               (* Certificate 0.5)
                               (* SmartCard 0.6)
                               (* Token 0.6)
                               (* SignCryp 0.3)
                               (* GroupSign 0.3)
                               (* RingSign 0.3)
                               (* Iris 0.3)
                               (* Face 0.3)
                               (* Fingerprint 0.3) (ite (> TwoFactor 0) 0.3 0)) count )
                                  )) 
;;Final FPSessionAttack  =(PSessionAttack - SessionAttackImpact )
(assert (= FPSessionAttack (- PSessionAttack SessionAttackImpact )))

;; We turned these authentication methdos off as they are not suitable for the healthcare scenarios
(assert (= PlateLicense 0))
(assert (= Certificate 0))

;;Final FPSessionAttack  =(PSessionAttack - SessionAttackImpact )
(assert (= FPSessionAttack (- PSessionAttack  SessionAttackImpact )))

;;likelihood of the attack = Probability of attack * Asset value 
(assert (= PRiskPImpersAttack (* FPImpersAttack AssetValue) ) )
(assert (= PRiskReplayAttack (* FPReplayAttack AssetValue) ) )
(assert (= PRiskSessionAttack (* FPSessionAttack AssetValue) ) )

;;likelihood of the attacks before the mitigation
(assert (= BPRiskPImpersAttack (* PImpersAttack AssetValue) ) )
(assert (= BPRiskReplayAttack (* PReplayAttack AssetValue) ) )
(assert (= BPRiskSessionAttack (* PSessionAttack AssetValue) ) )

;;TotalRisk=MAX(PRiskPImpersAttack  PRiskReplayAttack PRiskSessionAttack)
(assert (= TotalRisk (ite (>= PRiskPImpersAttack PRiskReplayAttack)
                     (ite (>= PRiskPImpersAttack PRiskSessionAttack) PRiskPImpersAttack PRiskSessionAttack)
                     (ite (>= PRiskReplayAttack PRiskSessionAttack) PRiskReplayAttack PRiskSessionAttack))))

;; Utility=AVG(Security  Usability Performance (- 1 TotalRisk))
(assert (<= Utility (/ (+ Security  Usability Performance (- 1 TotalRisk)) 4))) 





;; Contextual Factors
(assert (= Scanner 0))  ;;Laptop lacks scanner
(assert (= Reader 0))   ;; The lack of reader prevents Fingerprint
(assert (> Location 0))
(assert (> UnusualTime 0))
(assert (> UnknownDevice 0))
(assert (> UnsecuredWiFi 0))

(assert (> NonControlled 0))
(assert (> TreatmentPlan 0))
(assert (> Controlled 0))


;;Scenario 4 (done)
;(assert (> OtpLeng 0))
;(assert (> Iris 0))
;;Utility for Iris + OtpLeng
;;(assert (> Utility 0.427))
;;Security: 0.409
;;;Confidentiality: 0.508
;;;Integrity: 0.422
;;;Authenticity: 0.409
;;Usability: 0.227
;;;Effectiveness: 0.323
;;;Efficiency:0.227
;;Performance: 0.325
;;Total Risk: 0.254


;;Scenario 5 (done)
(assert (> PassStr 0))
(assert (= TwoFactor 0))
;;Utility for Password
;;(assert (> Utility 0.358))
;;Security: 0.71
;;;Confidentiality: 0.203
;;;Integrity: 0.186
;;;Authenticity: 0.082
;;Usability: 0.195
;;;Effectiveness:0.32
;;;Efficiency:0.195
;;Performance: 0.52
;;Total Risk: 0.363


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;Scenario 6 (done)
;;Utility for Face + Token
;;(assert (> Utility 0.468))
;;Security: 0.572
;;;Confidentiality: 0.75
;;;Integrity: 0.74
;;;Authenticity: 0.574
;;Usability: 0.325
;;;Effectiveness:0.64
;;;Efficiency:0.325
;;Performance: 0.227
;;Total Risk: 0.254

